!
no enable password
no aaa root
!
vlan internal order ascending range 1006 1199
!
transceiver qsfp default-mode 4x10G
!
service routing protocols model multi-agent
!
hostname s1-pe01
!
spanning-tree mode none
!
vlan 1101
   name ETHERNET_VPN_IRB_S1_CE01-02
!
vlan 1199
   name ETHERNET_VPN_L2VLAN
!
vlan 1301
   name FIREWALL-BGP-EXIT-S1-NORTH
!
vrf instance 
!
vrf instance FW
!
vrf instance IRB
!
management api http-commands
   protocol https
   no shutdown
   !
   vrf 
      no shutdown
!
interface Port-Channel4
   description to s1-ce01-po1
   no shutdown
   switchport trunk allowed vlan 1-4094
   switchport mode trunk
   switchport
   !
   evpn ethernet-segment
      identifier 0000:0000:0101:0101:0101
      redundancy all-active
      designated-forwarder election hold-time 1
      mpls shared index 100
      route-target import 01:01:01:01:01:01
   lacp system-id 0101.0101.0101
!
interface Ethernet1
   description P2P_s1-p01_Ethernet1
   no shutdown
   mtu 1500
   no switchport
   ip address 10.255.3.0/31
   mpls ip
   isis enable CORE
   isis circuit-type level-2
   isis metric 50
   isis hello padding
   isis network point-to-point
   isis authentication mode md5
   isis authentication key 7 $1c$sTNAlR6rKSw=
!
interface Ethernet2
   description P2P_s1-p02_Ethernet1
   no shutdown
   mtu 1500
   no switchport
   ip address 10.255.3.2/31
   mpls ip
   isis enable CORE
   isis circuit-type level-2
   isis metric 50
   isis hello padding
   isis network point-to-point
   isis authentication mode md5
   isis authentication key 7 $1c$sTNAlR6rKSw=
!
interface Ethernet4
   description ROUTER_s1-ce01_eth1
   no shutdown
   channel-group 4 mode active
!
interface Loopback0
   description ROUTER_ID
   no shutdown
   ip address 10.255.1.1/32
   node-segment ipv4 index 1
   isis enable CORE
   isis passive
!
interface Loopback1011
   description ETHERNET_VPN_IRB
   no shutdown
   vrf IRB
   ip address 10.1.255.1/32
!
interface Loopback1013
   description SVC_FIREWALL_LOOPBACK
   no shutdown
   vrf FW
   ip address 10.3.255.1/32
!
interface Management0
   description OOB_MANAGEMENT
   no shutdown
   vrf 
   ip address 192.168.2.11/24
!
interface Vlan1101
   description ETHERNET_VPN_IRB_S1_CE01-02
   no shutdown
   vrf IRB
   ip address virtual 10.1.1.1/24
!
interface Vlan1301
   description FIREWALL-BGP-EXIT-S1-NORTH
   no shutdown
   vrf FW
   ip address 10.3.1.2/24
   ip virtual-router address 10.3.1.1
!
ip virtual-router mac-address 00:1c:73:00:dc:00
!
ip routing
no ip routing vrf 
ip routing vrf FW
ip routing vrf IRB
!
ip route vrf  10.73.0.0/16 192.168.2.1
!
mpls ip
!
router bfd
   multihop interval 300 min-rx 300 multiplier 3
!
router bgp 65000
   router-id 10.255.1.1
   no bgp default ipv4-unicast
   maximum-paths 4 ecmp 4
   neighbor MPLS-OVERLAY-PEERS peer group
   neighbor MPLS-OVERLAY-PEERS remote-as 65000
   neighbor MPLS-OVERLAY-PEERS update-source Loopback0
   neighbor MPLS-OVERLAY-PEERS bfd
   neighbor MPLS-OVERLAY-PEERS password 7 Q4fqtbqcZ7oQuKfuWtNGRQ==
   neighbor MPLS-OVERLAY-PEERS send-community
   neighbor MPLS-OVERLAY-PEERS maximum-routes 0
   neighbor 10.255.0.1 peer group MPLS-OVERLAY-PEERS
   neighbor 10.255.0.1 description s1-p01_Loopback0
   neighbor 10.255.0.4 peer group MPLS-OVERLAY-PEERS
   neighbor 10.255.0.4 description s2-p02_Loopback0
   !
   vlan 1101
      rd 10.255.1.1:11101
      route-target both 11101:11101
      redistribute learned
   !
   vlan 1199
      rd 10.255.1.1:11199
      route-target both 11199:11199
      redistribute learned
   !
   vlan 1301
      rd 10.255.1.1:14301
      route-target both 14301:14301
      redistribute learned
   !
   address-family evpn
      neighbor default encapsulation mpls next-hop-self source-interface Loopback0
      neighbor MPLS-OVERLAY-PEERS activate
   !
   address-family ipv4
      no neighbor MPLS-OVERLAY-PEERS activate
   !
   vrf FW
      rd 10.255.1.1:13
      route-target import evpn 13:13
      route-target export evpn 13:13
      router-id 10.255.1.1
      neighbor 10.3.1.11 peer group FIREWALL-BGP
      neighbor 10.3.1.11 remote-as 65103
      neighbor 10.3.1.11 update-source Loopback1013
      neighbor 10.3.1.11 description FIREWALL-BGP S1-CE01
      neighbor 10.3.1.11 ebgp-multihop 10
      neighbor 10.3.1.11 send-community standard extended
      redistribute connected
      !
      address-family ipv4
         neighbor 10.3.1.11 activate
   !
   vrf IRB
      rd 10.255.1.1:11
      route-target import evpn 11:11
      route-target export evpn 11:11
      router-id 10.255.1.1
      redistribute connected
!
router isis CORE
   net 49.0001.0102.5500.1001.00
   router-id ipv4 10.255.1.1
   is-type level-2
   log-adjacency-changes
   !
   address-family ipv4 unicast
      maximum-paths 4
   !
   segment-routing mpls
      no shutdown
!
end
