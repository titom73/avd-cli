# Tox configuration for avd-cli
# This file maintains backward compatibility with tox commands while delegating to UV + Makefile
#
# Modern approach: Use Makefile targets directly (faster)
#   make lint
#   make type
#   make test
#
# Legacy approach: Use tox commands (backward compatible)
#   tox -e lint
#   tox -e type
#   tox -e test

[tox]
minversion = 4.0
envlist =
    lint
    type
    py{39,310,311,313}
    coverage
    clean
skipsdist = false
skip_missing_interpreters = true

[testenv]
description = Run tests with pytest
package = wheel
wheel_build_env = .pkg
deps =
    pytest>=7.4.0
    pytest-cov>=4.1.0
    pytest-mock>=3.11.0
commands =
    {envpython} -m pytest {posargs:tests/}

[testenv:py{39,310,311,313}]
description = Run tests on Python {basepython}
commands =
    {envpython} -m pytest -rA -q --color=yes --cov=avd_cli tests/

[testenv:lint]
description = Run linting checks (flake8 + pylint) using Makefile
skip_install = false
deps =
    flake8>=6.1.0
    pylint>=2.17.0
allowlist_externals = make
commands =
    make lint

[testenv:type]
description = Run type checking (mypy) using Makefile
skip_install = false
deps =
    mypy>=1.5.0
    types-PyYAML>=6.0.0
allowlist_externals = make
commands =
    make type

[testenv:test]
description = Run all tests using Makefile
deps =
    pytest>=7.4.0
    pytest-cov>=4.1.0
    pytest-mock>=3.11.0
allowlist_externals = make
commands =
    make test

[testenv:coverage]
description = Run tests with coverage report using Makefile
deps =
    pytest>=7.4.0
    pytest-cov>=4.1.0
    pytest-mock>=3.11.0
allowlist_externals = make
commands =
    make coverage

[testenv:clean]
description = Clean build artifacts and cache files
skip_install = true
allowlist_externals =
    rm
    find
    make
commands =
    make clean

[testenv:format]
description = Format code with black and isort
skip_install = false
deps =
    black>=23.0.0
    isort>=5.12.0
allowlist_externals = make
commands =
    make format

[testenv:format-check]
description = Check code formatting without modifying
skip_install = false
deps =
    black>=23.0.0
    isort>=5.12.0
commands =
    {envpython} -m black --check avd_cli tests
    {envpython} -m isort --check-only avd_cli tests

[testenv:pre-commit]
description = Run pre-commit hooks on all files
skip_install = false
deps =
    pre-commit>=3.4.0
commands =
    {envpython} -m pre-commit run --all-files

[testenv:check]
description = Run all checks (format, lint, type, test)
skip_install = false
deps =
    pytest>=7.4.0
    pytest-cov>=4.1.0
    pytest-mock>=3.11.0
    black>=23.0.0
    isort>=5.12.0
    mypy>=1.5.0
    flake8>=6.1.0
    pylint>=2.17.0
    types-PyYAML>=6.0.0
allowlist_externals = make
commands =
    make check

[testenv:dev]
description = Full development environment setup
skip_install = false
deps =
    pytest>=7.4.0
    pytest-cov>=4.1.0
    pytest-mock>=3.11.0
    black>=23.0.0
    mypy>=1.5.0
    flake8>=6.1.0
    pylint>=2.17.0
    pre-commit>=3.4.0
    types-PyYAML>=6.0.0
commands =
    {envpython} -m pre-commit install
    {envpython} --version

# CI/CD specific environments
[testenv:ci-lint]
description = CI: Run linting checks
skip_install = false
deps =
    flake8>=6.1.0
    pylint>=2.17.0
allowlist_externals = make
commands =
    make ci-lint

[testenv:ci-type]
description = CI: Run type checking
skip_install = false
deps =
    mypy>=1.5.0
    types-PyYAML>=6.0.0
allowlist_externals = make
commands =
    make ci-type

[testenv:ci-test]
description = CI: Run tests with coverage
deps =
    pytest>=7.4.0
    pytest-cov>=4.1.0
    pytest-mock>=3.11.0
allowlist_externals = make
commands =
    make ci-test

[testenv:ci-all]
description = CI: Run all checks
skip_install = false
deps =
    pytest>=7.4.0
    pytest-cov>=4.1.0
    pytest-mock>=3.11.0
    black>=23.0.0
    mypy>=1.5.0
    flake8>=6.1.0
    pylint>=2.17.0
    types-PyYAML>=6.0.0
allowlist_externals = make
commands =
    make ci-lint
    make ci-type
    make ci-test
